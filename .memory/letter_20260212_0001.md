# Letter to Myself (Session Handoff)

**Date:** 2026-02-12

## 1. Executive Summary
* **Goal:** Add Vercel Analytics, Airtable-backed contact form, sticky CTA, SEO improvements, and a /traffic dashboard to the MiniRAG landing page.
* **Current Status:** All code deployed to Vercel via `main`. Awaiting confirmation that the Airtable form submission works after the field-mapping fix (commit `823d489`).

## 2. The "Done" List (Context Anchor)
* Installed `@vercel/analytics`, `@vercel/speed-insights`, `zod`, `react-hook-form`, `@hookform/resolvers`
* Added `<Analytics />` and `<SpeedInsights />` to `src/app/layout.tsx`
* Created `src/lib/env.ts` — Airtable env var helper (supports `AIRTABLE_TABLE_ID` or `AIRTABLE_TABLE_NAME`)
* Created `src/lib/schemas.ts` — Zod v4 contact form schema (name, email, company, inquiryType, message, source)
* Created `src/actions/submit-contact.ts` — Server action POSTing to Airtable REST API
* Created `src/components/ui/glass-textarea.tsx` and `src/components/ui/glass-select.tsx` — glass-styled form controls
* Created `src/components/forms/contact-form.tsx` — react-hook-form + zodResolver, GlassCard wrapper
* Created `src/app/contact/page.tsx` — Contact page with SEO metadata
* Created `src/app/success/page.tsx` — Thank-you page with 3-step timeline in GlassCards
* Created `src/components/sections/sticky-cta.tsx` — Fixed bottom bar, shows after 50% scroll, dismissible via sessionStorage, hidden on `/contact` and `/success`
* Added `<StickyCTA />` to `src/app/layout.tsx` before `<ChatbotLoader />`
* Created `src/lib/seo-audit.ts` — Server-side SEO health checker for known pages
* Created `src/app/traffic/page.tsx` — SEO audit dashboard with score bar and per-page checks (noindex)
* Modified `src/components/layout/navigation.tsx` — Added "Contact" link
* Modified `src/components/layout/footer.tsx` — Added "Contact" to Product column
* Modified `src/components/sections/cta.tsx` — Added warm "Request a Demo" GlassButton between existing buttons
* Modified `src/app/robots.ts` — Disallow `/traffic` and `/success`
* Modified `src/app/sitemap.ts` — Added `/contact` entry (priority 0.8, monthly)
* Expanded SEO keywords in `src/app/layout.tsx` metadata (5 new keywords, updated description)
* Created 7 Airtable fields via API: Email, Company, Inquiry Type, Message, Source, Page URL, Submitted At

## 3. The "Pain" Log (CRITICAL)
* **Tried:** Zod v3 `errorMap` syntax (`errorMap: () => ({ message: "..." })`) in `z.enum()`
* **Failed:** Zod v4 doesn't have `errorMap` — TypeScript error `'errorMap' does not exist`
* **Workaround:** Use `error: "message string"` instead (Zod v4 API). Project has Zod 4.3.6.

* **Tried:** Zod v3 `.errors` property on `ZodError`
* **Failed:** Zod v4 uses `.issues` not `.errors`
* **Workaround:** Changed `parsed.error.errors[0].message` to `parsed.error.issues[0].message`

* **Tried:** Using `AIRTABLE_TABLE_NAME=tblFOqjDspjIO2msC` (a table ID, not a name)
* **Failed:** Airtable API returned NOT_FOUND when querying locally; 422 "Unknown field name: Email" on Vercel (table existed but fields didn't)
* **Workaround:** Added `AIRTABLE_TABLE_ID` env var support in `env.ts` (preferred over TABLE_NAME). Created missing fields via Airtable meta API. Changed default Status from "New" to "Todo" (existing option).

* **Tried:** Adding "New" choice to Status single-select via Airtable PATCH API
* **Failed:** `INVALID_REQUEST_UNKNOWN` — unclear validation failure
* **Workaround:** Used existing "Todo" status instead. Works fine semantically.

* *Note:* Airtable single-select fields reject empty strings — omit optional fields (Company, Source) from payload when empty.

## 4. Active Variable State
* **Vercel Env Vars (must be set):**
  - `AIRTABLE_API_KEY` — Personal access token (`pat...`)
  - `AIRTABLE_BASE_ID` — `app4JTsDEbrxhySRq`
  - `AIRTABLE_TABLE_ID` — `tblFOqjDspjIO2msC` (preferred) or `AIRTABLE_TABLE_NAME=minirag-leads`
* **Airtable table:** "Table 1" in base `app4JTsDEbrxhySRq`, fields: Name, Email, Company, Inquiry Type, Message, Source, Page URL, Submitted At, Status (Todo/In progress/Done), Notes, Assignee, Attachments, Attachment Summary
* **Git:** On `main`, latest commit `823d489`, pushed to origin
* **Local `.env.local`** now exists with Airtable credentials (was created mid-session for API debugging)

## 5. Immediate Next Steps
1. [ ] Verify contact form submission works on deployed Vercel site (submit test entry, check Airtable)
2. [ ] Confirm `AIRTABLE_TABLE_ID=tblFOqjDspjIO2msC` is set in Vercel env vars (not just TABLE_NAME)
3. [ ] Check Vercel Analytics beacon fires in browser Network tab (`/_vercel/insights`)
4. [ ] Test sticky CTA appears on scroll, dismisses properly, hides on /contact and /success
5. [ ] Consider renaming "Table 1" to "Leads" in Airtable UI for clarity
6. [ ] Rotate Airtable API key since it was exposed in terminal during debugging (`.env.local` is gitignored but key was used in raw curl commands)
