# Letter to Myself (Session Handoff)

**Date:** 2026-02-10

## 1. Executive Summary
* **Goal:** Fix MiniRAG chatbot widget — desktop not appearing, mobile styling clashing with dark theme, iOS input zoom issue.
* **Current Status:** All three issues resolved, widget confirmed working on desktop and mobile.

## 2. The "Done" List (Context Anchor)
* Fixed widget invisible on desktop by removing `animation` (transform), `filter`, and `will-change` from `minirag-widget` host element in `src/app/globals.css`
* Added viewport `maximumScale: 1` in `src/app/layout.tsx` to prevent iOS auto-zoom on chat input focus
* Updated widget CSS custom properties for dark theme: `--bg`, `--bg-secondary`, `--border`, `--shadow` in `src/app/globals.css`
* Rewrote `src/components/chatbot/chatbot-loader.tsx` — uses data attributes on script tag for auto-insert + `onload` fallback for manual widget creation
* Committed and deployed three commits: `e50d166`, `abc780b` (final fix)

## 3. The "Pain" Log (CRITICAL)
* **Tried:** Applying `animation: chatbot-bob` (transform: translateY) and `filter: drop-shadow()` to `minirag-widget` host element for a bobbing glow effect
* **Failed:** Widget bubble completely invisible on desktop. `transform`/`filter` on a Shadow DOM host element creates a new containing block, causing `position: fixed` inside Shadow DOM to be relative to the host (0x0 element) instead of the viewport.
* **Workaround:** Removed all `transform`, `filter`, `animation`, `will-change` from the host element. Only CSS custom properties are safe to set on a Shadow DOM host.
* *Note:* This is documented in `.claude/projects/.../memory/debugging.md`. Do NOT retry applying transforms/filters to Shadow DOM hosts.

* **Tried:** Removing data attributes from script tag and creating widget manually in `onload` callback to avoid `document.currentScript` issues
* **Failed:** This broke the widget's internal CSS URL resolution (`cssUrl` depends on `document.currentScript.src` to find `minirag-widget.css`)
* **Workaround:** Restored data attributes on script tag for correct CSS resolution, added `onload` fallback as belt-and-suspenders

## 4. Active Variable State
* Widget credentials hardcoded in `src/components/chatbot/chatbot-loader.tsx`:
  - BOT_ID: `df5b5ca2-68c4-4ae9-a2ef-9eceedd72df8`
  - API_URL: `https://mini-rag.de`
  - API_TOKEN: `_ULOzwCXkh9pV_Qp_tPkZvbXrT_fQavPKeJOi_wu1kM`
* Viewport `maximumScale: 1` is set globally (prevents all pinch-zoom, not just on widget input)
* Dark theme custom properties set in `globals.css` on `minirag-widget` selector

## 5. Immediate Next Steps
1. [ ] Verify dark theme is actually applied inside the widget chat window (outer CSS custom properties should override Shadow DOM `:host` defaults per CSS cascade)
2. [ ] Consider if `maximumScale: 1` is too aggressive for accessibility — could explore a JS-based approach that only restricts zoom when widget input is focused
3. [ ] The bobbing animation and glow effect on the chat bubble cannot be applied from outside Shadow DOM — would need changes to the widget source code in `mini-chat-rag` repo to support this
